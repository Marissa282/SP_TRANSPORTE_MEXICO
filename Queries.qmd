---
title: "Redes multinomiales"
author: "Marissa Luna, Mariana León, Nubia Garcidueñas, Ximena Cantón."
format:
   html:
     toc: true
     html-math-method: katex
     embed-resources: true 
     self-contained-math: true
     df-print: kable
editor: source
---

```{r}
#utilizamos ambiente de anaconda para cagar python
library(reticulate)
use_condaenv("base", required = TRUE)
```

# 1. Construcción de variables
✏️ **Construyan las variables que necesiten para dar respuesta a las queries asignadas. Si es necesario discreticen las variables continuas involucradas.**

Para la resolución de las queries se determinó el  conjunto de variables [E, S, O, P, T, D], donde: 

- Estrato (E):1 (bajo), 2 (medio bajo), 3 (medio alto), 4 (alto).
- Semana (S): 1 (Viaje entre semana), 2 (Viaje en domingo).
- Origen (O): 1 (Su Hogar), 2 (Escuela), 3 (Oficina)... 16 (Otro).
- Propósito (P): 1 (Ir al hogar), 2 (Ir al estudiar), 3 (Ir a estudiar)... 10 (Otro).
- Transporte (T): 1	(Automóvil), 2	(Colectivo/Micro), 3	(Taxi)... 20	(Otro).
- Duración (D): 0 (Menor o igual a 60 min), 1 (Más de 60 min).

```{python}
import pandas as pd 
```

```{python}
viajes=pd.read_csv("/Users/marissaluna/Documents/SP_TRANSPORTE/data/eod_2017_csv/tviaje_eod2017/conjunto_de_datos/tviaje.csv")
transportes= pd.read_csv("/Users/marissaluna/Documents/SP_TRANSPORTE/data/eod_2017_csv/ttransporte_eod2017/conjunto_de_datos/ttransporte.csv")
```

```{python}
viajes.head()
```

```{python}
transportes.head()
```

```{python}
#unimos los df en id_via 
df_joined = pd.merge(viajes, transportes, on = "id_via", how = "inner")
```

```{python}
#seleccionamos las columnas necesarias para represetar nuestras variables [E, S, O, P, T, D]
vars_= ["id_via","id_tra", "estrato_x","p5_3_x","p5_6","p5_9_1","p5_9_2","p5_10_1","p5_10_2","p5_13","p5_14","p5_14_16" ]
df_final= df_joined[vars_]
```

```{python}
#cambiamos nombre de las columnas 
df_final.columns = ["id_via", "id_tra", "E", "S", "O","Hora1","Min1", "Hora2","Min2", "P", "T", "bicitaxi"]
```

```{python}
df_final.head()
```

```{python}
#agregamos una columna de duración
#resultado de la resta de el comienzo y culminación del viaje
df_final["Duracion"]= (df_final["Hora2"]*60 + df_final["Min2"]) - (df_final["Hora1"]*60 + df_final["Min1"])
```

```{python}
#discretizamos la var. Duracion 
#>60 = 1, <=60 = 0 
df_final["D"]= (df_final["Duracion"] > 60).astype(int)

```

```{python}
#hacemos df nuevo con las variables finales
df_finalisimo = df_final[["E","S","O","P","T","D"]]
```

```{python}
df_finalisimo.head()
```
#hasta aqui es mi parte

✏️ Propongan al menos 3 diferentes DAGs que representen las relaciones de dependencia entre todas las variables de interés.

```{python}
library(bnlearn) 
```

```{python}
data = read.csv("data/dag.csv", stringsAsFactors = TRUE)
data[] <- lapply(data, factor) #columnas a factor 
str(data)
```
```{python}
head(data)
```

DAG 1
```{python}
dag_1 = empty.graph(nodes = c("E", "S", "O", "P", "T", "D"))
```
```{python}
arc_set = matrix(c("E", "P",
                   "P", "S",
                   "E", "T",
                   "T", "D",
                   "O", "D"), byrow = TRUE, ncol = 2,
                 dimnames = list(NULL, c("from", "to")))
```
```{python}
arc_set
```
```{python}
arcs(dag_1) = arc_set
dag_1
```

DAG 2
```{python}
dag_2 = empty.graph(nodes = c("E", "S", "O", "P", "T", "D"))
```
```{python}
arc_set = matrix(c("E", "P",
                   "S", "P",
                   "S", "O",
                   "P", "T",
                   "O", "T",
                   "T","D"), byrow = TRUE, ncol = 2,
                 dimnames = list(NULL, c("from", "to")))
```
```{python}
arc_set
```
```{python}
arcs(dag_2) = arc_set
dag_2
```
DAG 3
```{python}
dag_3 = empty.graph(nodes = c("E", "S", "O", "P", "T", "D"))
```
```{python}
arc_set = matrix(c("O", "E",
                   "P", "E",
                   "P", "S",
                   "E", "T",
                   "T", "D"), byrow = TRUE, ncol = 2,
                 dimnames = list(NULL, c("from", "to")))
```
```{python}
arc_set
```
```{python}
arcs(dag_3) = arc_set
dag_3
```

✏️ Construyan una red bayesiana utilizando las DAGs que propusieron previamente.

✏️ Discutan la significancia de las relaciones de dependencia de sus DAGs.

✏️ ¿Cuál es la red que mejor se ajuste a sus datos? ¿Por qué?

✏️ Utilicen el algoritmo hill-climbing para obtener la mejor estructura de la DAG para estos datos.

## Query 1
¿Cuál es la probabilidad de que el viaje del hogar al trabajo dure más de 60 minutos si la persona usa transporte público?

Tablas necesarias: tviajes 

tviajes: 

HOGAR AL TRABAJO 
- p5_6 (Pregunta 5.6 ¿Qué tipo de lugar es el origen de su viaje?) 
- p5_11a (Pregunta 5.11a ¿Qué tipo de lugar fue el destino de su viaje?)
- p5_13 (Pregunta 5.13 ¿Cuál fue el propósito del viaje?)

DURACION DEL VIAJE 
- Pregunta 5.9.¿A qué hora comenzó?
- Pregunta 5.9.¿En qué minuto comenzó?
- Pregunta 5.10 ¿A qué hora terminó?
- Pregunta 5.10 ¿En qué minuto terminó?
- Pregunta 5.14 Dígame por favor sí utilizó 02 Colectivo/Micro como medio de transporte

TRANSPORTE PUBLICO 

Pregunta 5.14 Dígame por favor sí utilizó 02 Colectivo/Micro como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó 03 Taxi (App internet) como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó  04 Taxi (sitio, calle u otro) como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó  05 Metro como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó 06 Autobús RTP o M1 como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó 07 Bicicleta como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó 08 Autobús como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó  09 Moto como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó 10 Trolebús como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó 11 Metrobús o Mexibús como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó 12 Tren ligero como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó 13 Tren suburbano como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó 15 Mexicable como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó 16 Bicitaxi como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó  17 Mototaxi como medio de transporte

Pregunta 5.14 Dígame por favor sí utilizó 01 automóvil como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó 18 Transporte  escolar como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó 19 Transporte  de personal como medio de transporte
Pregunta 5.14 Dígame por favor sí utilizó 20 Otro medio de transporte
Pregunta 5.14 Dígame por favor sí 14 Caminó en la calle como medio de transporte

```{r}
1 + 1
```

## Query 2
¿Cuál es la probabilidad de que un hogar tenga un automóvil propio, dado que la vivienda es propia?
```{r}
#| echo: false
2 * 2
```
## Query 3
¿Cuál es la probabilidad de que el estrato bajo, utilice transporte micro, metro, autobús?

```{r}
#| echo: false
2 * 2
```
##Query 3
¿Cuál es la probabilidad de que una persona viaje entre semana y sea de estrato medio bajo dado que va al trabajo en bicitaxi?
```{r}

```

